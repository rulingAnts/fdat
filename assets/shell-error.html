<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>FDAT — Connection Issue</title>
	<style>
		html, body { height: 100%; margin: 0; }
		body { display: grid; place-items: center; background: linear-gradient(180deg, #fff5f5, #ffffff); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:#332; }
		.card{ background:#fff; border:1px solid #ffd9d9; border-radius:14px; box-shadow: 0 8px 28px rgba(0,0,0,0.12); padding:16px 18px; width:min(560px, 92vw); }
		h1{ margin:0 0 6px 0; font-size:1.1rem; }
		.muted{ color:#665; font-size:0.95rem; }
		.row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:12px; }
		button{ background:#0b6edb; color:#fff; border:none; padding:8px 10px; border-radius:8px; cursor:pointer }
		button.secondary{ background:#eee; color:#111 }
		code{ background:#f8f8f8; padding:2px 4px; border-radius:4px; }
	</style>
	<meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
</head>
<body>
	<div class="card" role="alert" aria-live="polite">
		<h1>We couldn’t reach the FDAT site</h1>
		<div class="muted" id="desc">Check your internet connection or try again.</div>

		<div class="row">
			<button id="retryBtn">Retry</button>
			<button id="openProd" class="secondary">Open published site</button>
			<button id="openLocal" class="secondary">Open localhost</button>
		</div>

		<div class="muted" style="margin-top:10px" id="details"></div>
	</div>

	<script>
		(function(){
			const params = new URLSearchParams(location.search.slice(1));
			const target = params.get('target') || '';
			const prod = params.get('prod') || '';
			const isLocal = params.get('local') === '1';
			const code = params.get('code') || '';
			const err = params.get('err') || '';
			const url = params.get('url') || '';
			const details = document.getElementById('details');
			const desc = document.getElementById('desc');
			const retry = document.getElementById('retryBtn');
			const openProd = document.getElementById('openProd');
			const openLocal = document.getElementById('openLocal');

			if (code || err) {
				details.textContent = `Error${code? ' ' + code : ''}${err? ': ' + err : ''}${url? ' (' + url + ')' : ''}`;
			}
			if (isLocal) {
				desc.textContent = 'The local development server is not responding. Start the dev server or try the published site.';
			}
			retry.addEventListener('click', () => {
				location.href = target || '/';
			});
			// Add __ext=1 so Electron opens externally
			openProd.addEventListener('click', () => {
				const u = new URL(prod || target || '/', location.origin);
				u.searchParams.set('__ext','1');
				location.href = u.toString();
			});
			openLocal.addEventListener('click', () => {
				const u = new URL('http://localhost:5173/', location.origin);
				u.searchParams.set('__ext','1');
				location.href = u.toString();
			});
		})();
	</script>
</body>
</html>

